{
	"Data": {
		"Home-Issues": {
			"Issues": [
			{
				"Id": "342608332",
				"IsPullRequest": false,
				"CreatedAt": "2018-07-23T09:05:10",
				"Actor": "lserafin",
				"Number": "3340",
				"RawContent": null,
				"Title": "AutomaticDecompression not working with HttpClientFactory",
				"State": "closed",
				"Body": "I'm trying to set up **automatic gzip decompression** with the new **HttpClientFactory**.\r\nSomehow this is not working for me.\r\nCan you please let me know if I am doing something wrong ? \r\n\r\n```  C#\r\nusing Microsoft.Extensions.DependencyInjection;\r\nusing Microsoft.Extensions.Logging;\r\nusing Serilog;\r\nusing System;\r\nusing System.Net;\r\nusing System.Net.Http;\r\nusing System.Net.Http.Headers;\r\nusing System.Threading.Tasks;\r\n\r\nnamespace GzipTest\r\n{\r\n    class Program\r\n    {\r\n        // C# 7.1\r\n        static async Task Main()\r\n        {\r\n            await Go();\r\n        }\r\n\r\n        static async Task Go()\r\n        {\r\n            Log.Logger = new LoggerConfiguration()\r\n                .MinimumLevel.Debug()\r\n                .WriteTo.Console()\r\n                .CreateLogger();\r\n\r\n            var services = new ServiceCollection()\r\n                .AddLogging(builder =>\r\n                {\r\n                    // Add Serilog\r\n                    builder.AddSerilog();\r\n                });\r\n\r\n            // Register a HTTP Client\r\n            services.AddHttpClient<GzipTestClient>().ConfigureHttpMessageHandlerBuilder(config => new HttpClientHandler\r\n            {\r\n                AutomaticDecompression = DecompressionMethods.Deflate | DecompressionMethods.GZip\r\n            });\r\n\r\n            var serviceProvider = services.BuildServiceProvider();\r\n\r\n            // This is the Microsoft Logging interface\r\n            var logger = serviceProvider.GetRequiredService<ILogger<Program>>();\r\n            logger.LogInformation(\"We are using Serilog!\");\r\n\r\n            // Get a HTTP Client and make a request\r\n            var google = serviceProvider.GetRequiredService<GzipTestClient>();\r\n            await google.Get();\r\n        }\r\n    }\r\n\r\n    class GzipTestClient\r\n    {\r\n        HttpClient HttpClient { get; }\r\n        public GzipTestClient(HttpClient client)\r\n        {\r\n            HttpClient = client;\r\n            HttpClient.BaseAddress = new Uri(\"http://httpbin.org\");\r\n            HttpClient.DefaultRequestHeaders.AcceptEncoding.Add(new StringWithQualityHeaderValue(\"gzip\"));\r\n            HttpClient.DefaultRequestHeaders.AcceptEncoding.Add(new StringWithQualityHeaderValue(\"deflate\"));\r\n        }\r\n        public async Task<HttpResponseMessage> Get()\r\n        {\r\n            var request = new HttpRequestMessage(HttpMethod.Get, \"/gzip\");\r\n            var response = await HttpClient.SendAsync(request);\r\n            //var response = await HttpClient.GetAsync(\"/gzip\"); Also not working\r\n            var payload = response.Content.ReadAsStringAsync().Result;\r\n            Console.WriteLine(\"Decompressed Content:\\n{0}\", payload);\r\n            response.EnsureSuccessStatusCode();\r\n            return response;\r\n        }\r\n    }\r\n}\r\n```\r\n**Output**\r\n\r\n`[16:57:48 INF] We are using Serilog!\r\n[16:57:48 INF] Start processing HTTP request GET http://httpbin.org/gzip\r\n[16:57:48 INF] Sending HTTP request GET http://httpbin.org/gzip\r\n[16:57:48 INF] Received HTTP response after 440.1212ms - OK\r\n[16:57:48 INF] End processing HTTP request after 476.972ms - OK\r\nDecompressed Content:\r\n\u001f ?\u0003N[\u0002?\u001d?A\r\n?0\u0010E??Bf\u001d\u0003?\u0016?H??\u00025\u0019??:\u0013?qc??M]????/\u0010??3\u0006?|?@?)`??/p?\u001e?\u001e\u0006?\u0012?#???\u0003??I\u0011\f?\u0019??p+?,u?w??bR?Ob+%?j?????8<?$?\"m+w??l??\u001e/\u000e??\u000f??6N?\r\nPress any key to continue . . .`\r\n\r\n### Environment / dotnet Info\r\n\r\n```\r\n.NET Core SDK (reflecting any global.json):\r\n Version:   2.1.302\r\n Commit:    9048955601\r\n\r\nRuntime Environment:\r\n OS Name:     Windows\r\n OS Version:  10.0.17134\r\n OS Platform: Windows\r\n RID:         win10-x64\r\n Base Path:   C:\\Program Files\\dotnet\\sdk\\2.1.302\\\r\n\r\nHost (useful for support):\r\n  Version: 2.1.2\r\n  Commit:  811c3ce6c0\r\n\r\n.NET Core SDKs installed:\r\n  1.1.0 [C:\\Program Files\\dotnet\\sdk]\r\n  2.0.3 [C:\\Program Files\\dotnet\\sdk]\r\n  2.1.104 [C:\\Program Files\\dotnet\\sdk]\r\n  2.1.200 [C:\\Program Files\\dotnet\\sdk]\r\n  2.1.201 [C:\\Program Files\\dotnet\\sdk]\r\n  2.1.202 [C:\\Program Files\\dotnet\\sdk]\r\n  2.1.300-rc1-008673 [C:\\Program Files\\dotnet\\sdk]\r\n  2.1.300 [C:\\Program Files\\dotnet\\sdk]\r\n  2.1.302 [C:\\Program Files\\dotnet\\sdk]\r\n\r\n.NET Core runtimes installed:\r\n  Microsoft.AspNetCore.All 2.1.0-rc1-final [C:\\Program Files\\dotnet\\shared\\Microsoft.AspNetCore.All]\r\n  Microsoft.AspNetCore.All 2.1.0 [C:\\Program Files\\dotnet\\shared\\Microsoft.AspNetCore.All]\r\n  Microsoft.AspNetCore.All 2.1.2 [C:\\Program Files\\dotnet\\shared\\Microsoft.AspNetCore.All]\r\n  Microsoft.AspNetCore.App 2.1.0-rc1-final [C:\\Program Files\\dotnet\\shared\\Microsoft.AspNetCore.App]\r\n  Microsoft.AspNetCore.App 2.1.0 [C:\\Program Files\\dotnet\\shared\\Microsoft.AspNetCore.App]\r\n  Microsoft.AspNetCore.App 2.1.2 [C:\\Program Files\\dotnet\\shared\\Microsoft.AspNetCore.App]\r\n  Microsoft.NETCore.App 1.0.5 [C:\\Program Files\\dotnet\\shared\\Microsoft.NETCore.App]\r\n  Microsoft.NETCore.App 1.1.2 [C:\\Program Files\\dotnet\\shared\\Microsoft.NETCore.App]\r\n  Microsoft.NETCore.App 2.0.3 [C:\\Program Files\\dotnet\\shared\\Microsoft.NETCore.App]\r\n  Microsoft.NETCore.App 2.0.6 [C:\\Program Files\\dotnet\\shared\\Microsoft.NETCore.App]\r\n  Microsoft.NETCore.App 2.0.7 [C:\\Program Files\\dotnet\\shared\\Microsoft.NETCore.App]\r\n  Microsoft.NETCore.App 2.0.9 [C:\\Program Files\\dotnet\\shared\\Microsoft.NETCore.App]\r\n  Microsoft.NETCore.App 2.1.0-rc1 [C:\\Program Files\\dotnet\\shared\\Microsoft.NETCore.App]\r\n  Microsoft.NETCore.App 2.1.0 [C:\\Program Files\\dotnet\\shared\\Microsoft.NETCore.App]\r\n  Microsoft.NETCore.App 2.1.2 [C:\\Program Files\\dotnet\\shared\\Microsoft.NETCore.App]\r\n```\r\n\r\nSame code seems to be working without the HttpClientFactory (https://github.com/dotnet/corefx/issues/31121)",
				"Url": "https://github.com/aspnet/Home/issues/3340",
				"RelatedDescription": "Closed issue \"AutomaticDecompression not working with HttpClientFactory\" (#3340)"
			}],
			"ResultType": "GitHubIssue"
		}
	},
	"RunOn": "2018-07-24T05:30:22.990787Z",
	"RunDurationInMilliseconds": 17242
}
