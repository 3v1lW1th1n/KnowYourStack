{"Data":{"Sdk":{"Events":[{"Id":"8005771629","Type":"IssuesEvent","CreatedAt":"2018-07-23T18:53:22","Actor":"twsouthwick","Repository":"OfficeDev/Open-XML-SDK","Organization":"OfficeDev","RawContent":null,"RelatedAction":"closed","RelatedUrl":"https://github.com/OfficeDev/Open-XML-SDK/issues/513","RelatedDescription":"Closed issue \"Change in multiple rows in table highlight all table as changed\" (#513) at OfficeDev/Open-XML-SDK","RelatedBody":"# Before submitting an issue, please fill this out\r\n\r\nIs this a:\r\n- [x] Issue with the OpenXml library\r\n- [x] Question on library usage\r\n\r\nIf you have answered that this is a question, please ask it on StackOverflow instead of here.\r\nThis issue tracker is meant to track product issues while StackOverflow excels at answering questions\r\n\r\n---------------- Remove this line and above before posting ----------------\r\n\r\n**Description**\r\n\r\nPlease provide a simple description of the issue encountered.\r\n\r\n**Information**\r\n\r\n- .NET Target: (ie .NET Framework, .NET Core, UWP, Xamarin, etc)\r\n- DocumentFormat.OpenXml Version: (ie 2.7.2)\r\n\r\n**Repro**\r\n\r\n```csharp\r\n// Please add a self-contained, minimum viable repro of the issue.\r\n// If you require external resources, please provide a gist or GitHub repro\r\n// An Xunit style test is preferred, but a console application would work too.\r\n``` \r\n\r\n**Observed**\r\n\r\nPlease add your observed behavior here\r\n\r\n**Expected**\r\n\r\nPlease add your expected behavior here.\r\n"},{"Id":"7977404293","Type":"IssuesEvent","CreatedAt":"2018-07-17T15:14:05","Actor":"tomjebo","Repository":"OfficeDev/Open-XML-SDK","Organization":"OfficeDev","RawContent":null,"RelatedAction":"closed","RelatedUrl":"https://github.com/OfficeDev/Open-XML-SDK/issues/516","RelatedDescription":"Closed issue \"[General Question] Openxmlsdk: Replace MergeField by html text\" (#516) at OfficeDev/Open-XML-SDK","RelatedBody":"I'm using DocumentFormat.OpenXml to replace merge fields in my template docx file.\r\n\r\nStep 1, I write method to find merge field\r\n```csharp\r\nvar instructionRegEx = new Regex(@\"[\\w]*\\sMERGEFIELD\\s+(?<name>[\\w]+)\", RegexOptions.IgnoreCase | RegexOptions.IgnorePatternWhitespace | RegexOptions.Singleline);\r\n\r\nstring GetFieldName(OpenXmlElement field)\r\n{\r\n\tstring outerXml = field.OuterXml;\r\n\tif (!string.IsNullOrEmpty(outerXml))\r\n\t{\r\n\t\tMatch m = instructionRegEx.Match(outerXml);\r\n\t\tif (m.Success)\r\n\t\t{\r\n\t\t\treturn m.Groups[\"name\"].ToString().Trim();\r\n\t\t}\r\n\t}\r\n\treturn string.Empty;\r\n}\r\n\r\nusing (var docx = WordprocessingDocument.Open(filePath, true))\r\n{\r\n\tvar fields = docx.MainDocumentPart.RootElement.Descendants<SimpleField>().Select(item => (OpenXmlElement)item)\r\n\t\t.Concat(docx.MainDocumentPart.RootElement.Descendants<FieldCode>().Select(item => (OpenXmlElement)item))\r\n\t\t.ToList();\r\n\tforeach (var field in fields)\r\n\t{\r\n\t\tvar name = GetFieldName(field);\r\n\t\tif (string.IsNullOrEmpty(name)) continue;\r\n\t\tswitch (name)\r\n\t\t{\r\n\t\t ///\r\n\t\t}\r\n\t}\r\n}\r\n``` \r\nStep 2, I write method to replace html text\r\n```csharp\r\npublic static void ReplaceHtml(this WordprocessingDocument document, OpenXmlElement el, string html, bool disableHtmlHeader = false, string color = \"\", string alignment = \"\", string lineHeight = \"\", bool removeStyle = true)\r\n{\r\n\tvar formatImportPart = document.MainDocumentPart.AddAlternativeFormatImportPart(AlternativeFormatImportPartType.Html);\r\n\tvar idOfPart = document.MainDocumentPart.GetIdOfPart(formatImportPart);\r\n\tvar convertedHtml = html.ConvertHtmlContent(disableHtmlHeader: disableHtmlHeader, aligment: alignment, color: color, lineHeight: lineHeight, removeStyle: removeStyle);\r\n\tusing (var ms = new MemoryStream(Encoding.UTF8.GetBytes(convertedHtml)))\r\n\t{\r\n\t\tformatImportPart.FeedData(ms);\r\n\t}\r\n\tvar altChunk = new AltChunk\r\n\t{\r\n\t\tId = idOfPart\r\n\t};\r\n\tvar r = new Run();\r\n\tforeach (RunProperties placeholderrpr in el.Parent.Descendants<RunProperties>())\r\n\t{\r\n\t\tr.Append(new RunProperties(placeholderrpr.OuterXml));\r\n\t}\r\n\tr.Append(altChunk);\r\n\tReplaceElement(el, r);\r\n}\r\nprivate static void ReplaceElement(OpenXmlElement el, OpenXmlElement newEl)\r\n{\r\n\tif (el == null) return;\r\n\tif (el is SimpleField)\r\n\t{\r\n\t\tel.Parent.ReplaceChild(newEl, el);\r\n\t}\r\n\telse if (el is FieldCode)\r\n\t{\r\n\t\tvar parent = el.Parent;\r\n\t\tvar begin = parent.PreviousSibling();\r\n\t\tvar separate = parent.NextSibling();\r\n\t\tvar runText = separate.NextSibling();\r\n\t\tvar end = runText.NextSibling();\r\n\t\tvar another = end.NextSibling();\r\n\t\tvar container = parent.Parent;                    \r\n\t\tcontainer.InsertAfter(newEl, parent);\r\n\t\tcontainer.RemoveChild(parent);\r\n\t\tcontainer.RemoveChild(begin);\r\n\t\tcontainer.RemoveChild(separate);\r\n\t\tcontainer.RemoveChild(runText);\r\n\t\tcontainer.RemoveChild(end);\r\n\t}\r\n}\r\n``` \r\nCode work well when after RemoveChild, the paragraph that contains merge field become empty. But if it still contains some element, the docx file after replace merge fields will corrupt. I've open docx file by xml tool, and see results are as follows: \r\n![pic1](https://user-images.githubusercontent.com/12107588/42746064-42b77784-8900-11e8-8aa4-bbaf91a1c7ba.png)\r\n![pic2](https://user-images.githubusercontent.com/12107588/42746076-5128cfca-8900-11e8-91d6-c5666303ca16.png)\r\nSo, my question is, how can I replace a merge field inside a paragraph that contains another fields. Sorry for my English is not good"},{"Id":"7968938034","Type":"IssuesEvent","CreatedAt":"2018-07-16T06:59:06","Actor":"giangcoi48k","Repository":"OfficeDev/Open-XML-SDK","Organization":"OfficeDev","RawContent":null,"RelatedAction":"opened","RelatedUrl":"https://github.com/OfficeDev/Open-XML-SDK/issues/516","RelatedDescription":"Opened issue \"Openxmlsdk: Replace MergeField by html text\" (#516) at OfficeDev/Open-XML-SDK","RelatedBody":"I'm using DocumentFormat.OpenXml to replace merge fields in my template docx file.\r\n\r\nStep 1, I write method to find merge field\r\n```csharp\r\nvar instructionRegEx = new Regex(@\"[\\w]*\\sMERGEFIELD\\s+(?<name>[\\w]+)\", RegexOptions.IgnoreCase | RegexOptions.IgnorePatternWhitespace | RegexOptions.Singleline);\r\n\r\nstring GetFieldName(OpenXmlElement field)\r\n{\r\n\tstring outerXml = field.OuterXml;\r\n\tif (!string.IsNullOrEmpty(outerXml))\r\n\t{\r\n\t\tMatch m = instructionRegEx.Match(outerXml);\r\n\t\tif (m.Success)\r\n\t\t{\r\n\t\t\treturn m.Groups[\"name\"].ToString().Trim();\r\n\t\t}\r\n\t}\r\n\treturn string.Empty;\r\n}\r\n\r\nusing (var docx = WordprocessingDocument.Open(filePath, true))\r\n{\r\n\tvar fields = docx.MainDocumentPart.RootElement.Descendants<SimpleField>().Select(item => (OpenXmlElement)item)\r\n\t\t.Concat(docx.MainDocumentPart.RootElement.Descendants<FieldCode>().Select(item => (OpenXmlElement)item))\r\n\t\t.ToList();\r\n\tforeach (var field in fields)\r\n\t{\r\n\t\tvar name = GetFieldName(field);\r\n\t\tif (string.IsNullOrEmpty(name)) continue;\r\n\t\tswitch (name)\r\n\t\t{\r\n\t\t ///\r\n\t\t}\r\n\t}\r\n}\r\n``` \r\nStep 2, I write method to replace html text\r\n```csharp\r\npublic static void ReplaceHtml(this WordprocessingDocument document, OpenXmlElement el, string html, bool disableHtmlHeader = false, string color = \"\", string alignment = \"\", string lineHeight = \"\", bool removeStyle = true)\r\n{\r\n\tvar formatImportPart = document.MainDocumentPart.AddAlternativeFormatImportPart(AlternativeFormatImportPartType.Html);\r\n\tvar idOfPart = document.MainDocumentPart.GetIdOfPart(formatImportPart);\r\n\tvar convertedHtml = html.ConvertHtmlContent(disableHtmlHeader: disableHtmlHeader, aligment: alignment, color: color, lineHeight: lineHeight, removeStyle: removeStyle);\r\n\tusing (var ms = new MemoryStream(Encoding.UTF8.GetBytes(convertedHtml)))\r\n\t{\r\n\t\tformatImportPart.FeedData(ms);\r\n\t}\r\n\tvar altChunk = new AltChunk\r\n\t{\r\n\t\tId = idOfPart\r\n\t};\r\n\tvar r = new Run();\r\n\tforeach (RunProperties placeholderrpr in el.Parent.Descendants<RunProperties>())\r\n\t{\r\n\t\tr.Append(new RunProperties(placeholderrpr.OuterXml));\r\n\t}\r\n\tr.Append(altChunk);\r\n\tReplaceElement(el, r);\r\n}\r\nprivate static void ReplaceElement(OpenXmlElement el, OpenXmlElement newEl)\r\n{\r\n\tif (el == null) return;\r\n\tif (el is SimpleField)\r\n\t{\r\n\t\tel.Parent.ReplaceChild(newEl, el);\r\n\t}\r\n\telse if (el is FieldCode)\r\n\t{\r\n\t\tvar parent = el.Parent;\r\n\t\tvar begin = parent.PreviousSibling();\r\n\t\tvar separate = parent.NextSibling();\r\n\t\tvar runText = separate.NextSibling();\r\n\t\tvar end = runText.NextSibling();\r\n\t\tvar another = end.NextSibling();\r\n\t\tvar container = parent.Parent;                    \r\n\t\tcontainer.InsertAfter(newEl, parent);\r\n\t\tcontainer.RemoveChild(parent);\r\n\t\tcontainer.RemoveChild(begin);\r\n\t\tcontainer.RemoveChild(separate);\r\n\t\tcontainer.RemoveChild(runText);\r\n\t\tcontainer.RemoveChild(end);\r\n\t}\r\n}\r\n``` \r\nCode work well when after RemoveChild, the paragraph that contains merge field become empty. But if it still contains some element, the docx file after replace merge fields will corrupt. I've open docx file by xml tool, and see results are as follows: \r\n![pic1](https://user-images.githubusercontent.com/12107588/42746064-42b77784-8900-11e8-8aa4-bbaf91a1c7ba.png)\r\n![pic2](https://user-images.githubusercontent.com/12107588/42746076-5128cfca-8900-11e8-91d6-c5666303ca16.png)\r\nSo, my question is, how can I replace a merge field inside a paragraph that contains another fields. Sorry for my English is not good"},{"Id":"7964986801","Type":"IssuesEvent","CreatedAt":"2018-07-14T01:27:33","Actor":"twsouthwick","Repository":"OfficeDev/Open-XML-SDK","Organization":"OfficeDev","RawContent":null,"RelatedAction":"closed","RelatedUrl":"https://github.com/OfficeDev/Open-XML-SDK/issues/515","RelatedDescription":"Closed issue \"While trying to convert the following word document to HTML the output is distorted.\" (#515) at OfficeDev/Open-XML-SDK","RelatedBody":"While trying to convert the following word document to HTML the output is distorted.\r\n\r\nOrignal document\r\n[Pratish_DOC_SAmple.docx](https://github.com/OfficeDev/Open-XML-SDK/files/2191614/Pratish_DOC_SAmple.docx)\r\n\r\nOutput \r\n![testoutput](https://user-images.githubusercontent.com/41182805/42677653-010e8ace-869a-11e8-8419-85063f002584.png)\r\n\r\nCode \r\n\r\n using (DocumentFormat.OpenXml.Packaging.WordprocessingDocument doc =\r\n                   DocumentFormat.OpenXml.Packaging.WordprocessingDocument.Open(memoryStream, true))\r\n               {\r\n                   HtmlConverterSettings settings = new HtmlConverterSettings()\r\n                   {\r\n           \r\n                    };\r\n                    XElement html = HtmlConverter.ConvertToHtml(doc, settings);"},{"Id":"7960459889","Type":"IssuesEvent","CreatedAt":"2018-07-13T07:18:47","Actor":"pratisharora","Repository":"OfficeDev/Open-XML-SDK","Organization":"OfficeDev","RawContent":null,"RelatedAction":"opened","RelatedUrl":"https://github.com/OfficeDev/Open-XML-SDK/issues/515","RelatedDescription":"Opened issue \"While trying to convert the following word document to HTML the output is distorted.\" (#515) at OfficeDev/Open-XML-SDK","RelatedBody":"While trying to convert the following word document to HTML the output is distorted.\r\n\r\nOrignal document\r\n[Pratish_DOC_SAmple.docx](https://github.com/OfficeDev/Open-XML-SDK/files/2191614/Pratish_DOC_SAmple.docx)\r\n\r\nOutput \r\n![testoutput](https://user-images.githubusercontent.com/41182805/42677653-010e8ace-869a-11e8-8419-85063f002584.png)\r\n\r\nCode \r\n\r\n using (DocumentFormat.OpenXml.Packaging.WordprocessingDocument doc =\r\n                   DocumentFormat.OpenXml.Packaging.WordprocessingDocument.Open(memoryStream, true))\r\n               {\r\n                   HtmlConverterSettings settings = new HtmlConverterSettings()\r\n                   {\r\n           \r\n                    };\r\n                    XElement html = HtmlConverter.ConvertToHtml(doc, settings);"}],"ResultType":"GitHubEvent"},"PowerTools":{"Events":[{"Id":"7997530404","Type":"PullRequestEvent","CreatedAt":"2018-07-20T22:51:08","Actor":"PhenX","Repository":"OfficeDev/Open-Xml-PowerTools","Organization":"OfficeDev","RawContent":null,"RelatedAction":"opened","RelatedUrl":"https://github.com/OfficeDev/Open-Xml-PowerTools/pull/238","RelatedDescription":"Opened pull request \"Add support for .Net Core\" (#238) at OfficeDev/Open-Xml-PowerTools","RelatedBody":""},{"Id":"7987436562","Type":"PullRequestEvent","CreatedAt":"2018-07-19T07:47:20","Actor":"jtasek","Repository":"OfficeDev/Open-Xml-PowerTools","Organization":"OfficeDev","RawContent":null,"RelatedAction":"opened","RelatedUrl":"https://github.com/OfficeDev/Open-Xml-PowerTools/pull/237","RelatedDescription":"Opened pull request \"Added missing image/bmp type to ImageContentTypes\" (#237) at OfficeDev/Open-Xml-PowerTools","RelatedBody":"Added \"bmp\" format into content types to fix missing images issue after conversion to html."}],"ResultType":"GitHubEvent"}},"RunOn":"2018-07-24T05:30:46.6160607Z","RunDurationInMilliseconds":1836}