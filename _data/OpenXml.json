{"Data":{"Sdk":{"Events":[{"Id":"7977404293","Type":"IssuesEvent","CreatedAt":"2018-07-17T15:14:05","Actor":"tomjebo","Repository":"OfficeDev/Open-XML-SDK","Organization":"OfficeDev","RawContent":null,"RelatedAction":"closed","RelatedUrl":"https://github.com/OfficeDev/Open-XML-SDK/issues/516","RelatedDescription":"Closed issue \"[General Question] Openxmlsdk: Replace MergeField by html text\" (#516) at OfficeDev/Open-XML-SDK","RelatedBody":"I'm using DocumentFormat.OpenXml to replace merge fields in my template docx file.\r\n\r\nStep 1, I write method to find merge field\r\n```csharp\r\nvar instructionRegEx = new Regex(@\"[\\w]*\\sMERGEFIELD\\s+(?<name>[\\w]+)\", RegexOptions.IgnoreCase | RegexOptions.IgnorePatternWhitespace | RegexOptions.Singleline);\r\n\r\nstring GetFieldName(OpenXmlElement field)\r\n{\r\n\tstring outerXml = field.OuterXml;\r\n\tif (!string.IsNullOrEmpty(outerXml))\r\n\t{\r\n\t\tMatch m = instructionRegEx.Match(outerXml);\r\n\t\tif (m.Success)\r\n\t\t{\r\n\t\t\treturn m.Groups[\"name\"].ToString().Trim();\r\n\t\t}\r\n\t}\r\n\treturn string.Empty;\r\n}\r\n\r\nusing (var docx = WordprocessingDocument.Open(filePath, true))\r\n{\r\n\tvar fields = docx.MainDocumentPart.RootElement.Descendants<SimpleField>().Select(item => (OpenXmlElement)item)\r\n\t\t.Concat(docx.MainDocumentPart.RootElement.Descendants<FieldCode>().Select(item => (OpenXmlElement)item))\r\n\t\t.ToList();\r\n\tforeach (var field in fields)\r\n\t{\r\n\t\tvar name = GetFieldName(field);\r\n\t\tif (string.IsNullOrEmpty(name)) continue;\r\n\t\tswitch (name)\r\n\t\t{\r\n\t\t ///\r\n\t\t}\r\n\t}\r\n}\r\n``` \r\nStep 2, I write method to replace html text\r\n```csharp\r\npublic static void ReplaceHtml(this WordprocessingDocument document, OpenXmlElement el, string html, bool disableHtmlHeader = false, string color = \"\", string alignment = \"\", string lineHeight = \"\", bool removeStyle = true)\r\n{\r\n\tvar formatImportPart = document.MainDocumentPart.AddAlternativeFormatImportPart(AlternativeFormatImportPartType.Html);\r\n\tvar idOfPart = document.MainDocumentPart.GetIdOfPart(formatImportPart);\r\n\tvar convertedHtml = html.ConvertHtmlContent(disableHtmlHeader: disableHtmlHeader, aligment: alignment, color: color, lineHeight: lineHeight, removeStyle: removeStyle);\r\n\tusing (var ms = new MemoryStream(Encoding.UTF8.GetBytes(convertedHtml)))\r\n\t{\r\n\t\tformatImportPart.FeedData(ms);\r\n\t}\r\n\tvar altChunk = new AltChunk\r\n\t{\r\n\t\tId = idOfPart\r\n\t};\r\n\tvar r = new Run();\r\n\tforeach (RunProperties placeholderrpr in el.Parent.Descendants<RunProperties>())\r\n\t{\r\n\t\tr.Append(new RunProperties(placeholderrpr.OuterXml));\r\n\t}\r\n\tr.Append(altChunk);\r\n\tReplaceElement(el, r);\r\n}\r\nprivate static void ReplaceElement(OpenXmlElement el, OpenXmlElement newEl)\r\n{\r\n\tif (el == null) return;\r\n\tif (el is SimpleField)\r\n\t{\r\n\t\tel.Parent.ReplaceChild(newEl, el);\r\n\t}\r\n\telse if (el is FieldCode)\r\n\t{\r\n\t\tvar parent = el.Parent;\r\n\t\tvar begin = parent.PreviousSibling();\r\n\t\tvar separate = parent.NextSibling();\r\n\t\tvar runText = separate.NextSibling();\r\n\t\tvar end = runText.NextSibling();\r\n\t\tvar another = end.NextSibling();\r\n\t\tvar container = parent.Parent;                    \r\n\t\tcontainer.InsertAfter(newEl, parent);\r\n\t\tcontainer.RemoveChild(parent);\r\n\t\tcontainer.RemoveChild(begin);\r\n\t\tcontainer.RemoveChild(separate);\r\n\t\tcontainer.RemoveChild(runText);\r\n\t\tcontainer.RemoveChild(end);\r\n\t}\r\n}\r\n``` \r\nCode work well when after RemoveChild, the paragraph that contains merge field become empty. But if it still contains some element, the docx file after replace merge fields will corrupt. I've open docx file by xml tool, and see results are as follows: \r\n![pic1](https://user-images.githubusercontent.com/12107588/42746064-42b77784-8900-11e8-8aa4-bbaf91a1c7ba.png)\r\n![pic2](https://user-images.githubusercontent.com/12107588/42746076-5128cfca-8900-11e8-91d6-c5666303ca16.png)\r\nSo, my question is, how can I replace a merge field inside a paragraph that contains another fields. Sorry for my English is not good"},{"Id":"7968938034","Type":"IssuesEvent","CreatedAt":"2018-07-16T06:59:06","Actor":"giangcoi48k","Repository":"OfficeDev/Open-XML-SDK","Organization":"OfficeDev","RawContent":null,"RelatedAction":"opened","RelatedUrl":"https://github.com/OfficeDev/Open-XML-SDK/issues/516","RelatedDescription":"Opened issue \"Openxmlsdk: Replace MergeField by html text\" (#516) at OfficeDev/Open-XML-SDK","RelatedBody":"I'm using DocumentFormat.OpenXml to replace merge fields in my template docx file.\r\n\r\nStep 1, I write method to find merge field\r\n```csharp\r\nvar instructionRegEx = new Regex(@\"[\\w]*\\sMERGEFIELD\\s+(?<name>[\\w]+)\", RegexOptions.IgnoreCase | RegexOptions.IgnorePatternWhitespace | RegexOptions.Singleline);\r\n\r\nstring GetFieldName(OpenXmlElement field)\r\n{\r\n\tstring outerXml = field.OuterXml;\r\n\tif (!string.IsNullOrEmpty(outerXml))\r\n\t{\r\n\t\tMatch m = instructionRegEx.Match(outerXml);\r\n\t\tif (m.Success)\r\n\t\t{\r\n\t\t\treturn m.Groups[\"name\"].ToString().Trim();\r\n\t\t}\r\n\t}\r\n\treturn string.Empty;\r\n}\r\n\r\nusing (var docx = WordprocessingDocument.Open(filePath, true))\r\n{\r\n\tvar fields = docx.MainDocumentPart.RootElement.Descendants<SimpleField>().Select(item => (OpenXmlElement)item)\r\n\t\t.Concat(docx.MainDocumentPart.RootElement.Descendants<FieldCode>().Select(item => (OpenXmlElement)item))\r\n\t\t.ToList();\r\n\tforeach (var field in fields)\r\n\t{\r\n\t\tvar name = GetFieldName(field);\r\n\t\tif (string.IsNullOrEmpty(name)) continue;\r\n\t\tswitch (name)\r\n\t\t{\r\n\t\t ///\r\n\t\t}\r\n\t}\r\n}\r\n``` \r\nStep 2, I write method to replace html text\r\n```csharp\r\npublic static void ReplaceHtml(this WordprocessingDocument document, OpenXmlElement el, string html, bool disableHtmlHeader = false, string color = \"\", string alignment = \"\", string lineHeight = \"\", bool removeStyle = true)\r\n{\r\n\tvar formatImportPart = document.MainDocumentPart.AddAlternativeFormatImportPart(AlternativeFormatImportPartType.Html);\r\n\tvar idOfPart = document.MainDocumentPart.GetIdOfPart(formatImportPart);\r\n\tvar convertedHtml = html.ConvertHtmlContent(disableHtmlHeader: disableHtmlHeader, aligment: alignment, color: color, lineHeight: lineHeight, removeStyle: removeStyle);\r\n\tusing (var ms = new MemoryStream(Encoding.UTF8.GetBytes(convertedHtml)))\r\n\t{\r\n\t\tformatImportPart.FeedData(ms);\r\n\t}\r\n\tvar altChunk = new AltChunk\r\n\t{\r\n\t\tId = idOfPart\r\n\t};\r\n\tvar r = new Run();\r\n\tforeach (RunProperties placeholderrpr in el.Parent.Descendants<RunProperties>())\r\n\t{\r\n\t\tr.Append(new RunProperties(placeholderrpr.OuterXml));\r\n\t}\r\n\tr.Append(altChunk);\r\n\tReplaceElement(el, r);\r\n}\r\nprivate static void ReplaceElement(OpenXmlElement el, OpenXmlElement newEl)\r\n{\r\n\tif (el == null) return;\r\n\tif (el is SimpleField)\r\n\t{\r\n\t\tel.Parent.ReplaceChild(newEl, el);\r\n\t}\r\n\telse if (el is FieldCode)\r\n\t{\r\n\t\tvar parent = el.Parent;\r\n\t\tvar begin = parent.PreviousSibling();\r\n\t\tvar separate = parent.NextSibling();\r\n\t\tvar runText = separate.NextSibling();\r\n\t\tvar end = runText.NextSibling();\r\n\t\tvar another = end.NextSibling();\r\n\t\tvar container = parent.Parent;                    \r\n\t\tcontainer.InsertAfter(newEl, parent);\r\n\t\tcontainer.RemoveChild(parent);\r\n\t\tcontainer.RemoveChild(begin);\r\n\t\tcontainer.RemoveChild(separate);\r\n\t\tcontainer.RemoveChild(runText);\r\n\t\tcontainer.RemoveChild(end);\r\n\t}\r\n}\r\n``` \r\nCode work well when after RemoveChild, the paragraph that contains merge field become empty. But if it still contains some element, the docx file after replace merge fields will corrupt. I've open docx file by xml tool, and see results are as follows: \r\n![pic1](https://user-images.githubusercontent.com/12107588/42746064-42b77784-8900-11e8-8aa4-bbaf91a1c7ba.png)\r\n![pic2](https://user-images.githubusercontent.com/12107588/42746076-5128cfca-8900-11e8-91d6-c5666303ca16.png)\r\nSo, my question is, how can I replace a merge field inside a paragraph that contains another fields. Sorry for my English is not good"},{"Id":"7964986801","Type":"IssuesEvent","CreatedAt":"2018-07-14T01:27:33","Actor":"twsouthwick","Repository":"OfficeDev/Open-XML-SDK","Organization":"OfficeDev","RawContent":null,"RelatedAction":"closed","RelatedUrl":"https://github.com/OfficeDev/Open-XML-SDK/issues/515","RelatedDescription":"Closed issue \"While trying to convert the following word document to HTML the output is distorted.\" (#515) at OfficeDev/Open-XML-SDK","RelatedBody":"While trying to convert the following word document to HTML the output is distorted.\r\n\r\nOrignal document\r\n[Pratish_DOC_SAmple.docx](https://github.com/OfficeDev/Open-XML-SDK/files/2191614/Pratish_DOC_SAmple.docx)\r\n\r\nOutput \r\n![testoutput](https://user-images.githubusercontent.com/41182805/42677653-010e8ace-869a-11e8-8419-85063f002584.png)\r\n\r\nCode \r\n\r\n using (DocumentFormat.OpenXml.Packaging.WordprocessingDocument doc =\r\n                   DocumentFormat.OpenXml.Packaging.WordprocessingDocument.Open(memoryStream, true))\r\n               {\r\n                   HtmlConverterSettings settings = new HtmlConverterSettings()\r\n                   {\r\n           \r\n                    };\r\n                    XElement html = HtmlConverter.ConvertToHtml(doc, settings);"},{"Id":"7960459889","Type":"IssuesEvent","CreatedAt":"2018-07-13T07:18:47","Actor":"pratisharora","Repository":"OfficeDev/Open-XML-SDK","Organization":"OfficeDev","RawContent":null,"RelatedAction":"opened","RelatedUrl":"https://github.com/OfficeDev/Open-XML-SDK/issues/515","RelatedDescription":"Opened issue \"While trying to convert the following word document to HTML the output is distorted.\" (#515) at OfficeDev/Open-XML-SDK","RelatedBody":"While trying to convert the following word document to HTML the output is distorted.\r\n\r\nOrignal document\r\n[Pratish_DOC_SAmple.docx](https://github.com/OfficeDev/Open-XML-SDK/files/2191614/Pratish_DOC_SAmple.docx)\r\n\r\nOutput \r\n![testoutput](https://user-images.githubusercontent.com/41182805/42677653-010e8ace-869a-11e8-8419-85063f002584.png)\r\n\r\nCode \r\n\r\n using (DocumentFormat.OpenXml.Packaging.WordprocessingDocument doc =\r\n                   DocumentFormat.OpenXml.Packaging.WordprocessingDocument.Open(memoryStream, true))\r\n               {\r\n                   HtmlConverterSettings settings = new HtmlConverterSettings()\r\n                   {\r\n           \r\n                    };\r\n                    XElement html = HtmlConverter.ConvertToHtml(doc, settings);"},{"Id":"7946486111","Type":"IssuesEvent","CreatedAt":"2018-07-10T21:29:57","Actor":"chandrab699","Repository":"OfficeDev/Open-XML-SDK","Organization":"OfficeDev","RawContent":null,"RelatedAction":"closed","RelatedUrl":"https://github.com/OfficeDev/Open-XML-SDK/issues/514","RelatedDescription":"Closed issue \"Compile Windows Application\" (#514) at OfficeDev/Open-XML-SDK","RelatedBody":"# Before submitting an issue, please fill this out\r\n\r\nIs this a:\r\n- [ No] Issue with the OpenXml library\r\n- [Yes] Question on library usage\r\n\r\nIf you have answered that this is a question, please ask it on StackOverflow instead of here.\r\nThis issue tracker is meant to track product issues while StackOverflow excels at answering questions\r\n\r\n---------------- Remove this line and above before posting ----------------\r\n\r\n**Description**\r\n\r\nHow to create a Windows application to perform text changes on Word/Excel documents.\r\n\r\n\r\n**Repro**\r\nI have a VBA script to modify Word document. If I create a VBA addin in word, source code will be revealed. I do not want to give out the source code of the VBA script. \r\nI want to refactor my code to C#, which could also my code faster.\r\nI want to create a windows application, which accepts a docx/xlsx document and make changes. Save the file back with a new name in the same location.\r\nThe windows application should not reveal the code, if extracted in any way."}],"ResultType":"GitHubEvent"},"PowerTools":{"Events":[{"Id":"7968896309","Type":"PullRequestEvent","CreatedAt":"2018-07-16T06:45:01","Actor":"krembf","Repository":"OfficeDev/Open-Xml-PowerTools","Organization":"OfficeDev","RawContent":null,"RelatedAction":"opened","RelatedUrl":"https://github.com/OfficeDev/Open-Xml-PowerTools/pull/236","RelatedDescription":"Opened pull request \"DocumentAssembler: Support for Images (#42)\" (#236) at OfficeDev/Open-Xml-PowerTools","RelatedBody":"Implementation of feature request to support templated images in Document Assembler."},{"Id":"7965347339","Type":"IssuesEvent","CreatedAt":"2018-07-14T06:58:58","Actor":"pratisharora","Repository":"OfficeDev/Open-Xml-PowerTools","Organization":"OfficeDev","RawContent":null,"RelatedAction":"opened","RelatedUrl":"https://github.com/OfficeDev/Open-Xml-PowerTools/issues/235","RelatedDescription":"Opened issue \"While trying to convert the following word document to HTML the output has extra spaces between words.\" (#235) at OfficeDev/Open-Xml-PowerTools","RelatedBody":"While trying to convert the following word document to HTML the output has extra spaces between words.\r\n\r\nSee the input documnet the second word presentation is split to     prese  n  tation, the same goes for many other words.\r\n\r\nOrignal document\r\n[Pratish_DOC_SAmple.docx](https://github.com/OfficeDev/Open-Xml-PowerTools/files/2194734/Pratish_DOC_SAmple.docx)\r\nOutput\r\n![image](https://user-images.githubusercontent.com/41182805/42721979-6cac83cc-8761-11e8-9829-885ab5ff6ae8.png)\r\n"},{"Id":"7957704874","Type":"IssuesEvent","CreatedAt":"2018-07-12T17:38:39","Actor":"DeuteriumCore","Repository":"OfficeDev/Open-Xml-PowerTools","Organization":"OfficeDev","RawContent":null,"RelatedAction":"opened","RelatedUrl":"https://github.com/OfficeDev/Open-Xml-PowerTools/issues/234","RelatedDescription":"Opened issue \"Error: Sequence contains no elements when running DocumentBuilder on a server\" (#234) at OfficeDev/Open-Xml-PowerTools","RelatedBody":"However, when I run part of the code that merges two documents on my computer, it works fine. Any help? Thanks!\r\n\r\nHere is the code:\r\n`using (WordprocessingDocument wDocIn = WordprocessingDocument.Open(mem, false))\r\n                using (WordprocessingDocument wDocTemplate = WordprocessingDocument.Open(mem2, false))\r\n                {\r\n                    List<Source> sources = new List<Source>();\r\n\r\n                    WmlDocument wmlIn = new WmlDocument(\"\", mem);\r\n                    WmlDocument wmlTemplate = new WmlDocument(\"\", mem2);\r\n\r\n                    sources.Add(new Source(wmlIn, true));\r\n                    sources.Add(new Source(wmlTemplate, true));\r\n                    \r\n                    wmlIn = DocumentBuilder.BuildDocument(sources);\r\n\r\n                    Output = wmlIn.DocumentByteArray;\r\n                }`\r\n\r\nUnfortunately, I cannot debug the program uploaded on the server since it's . . . OutSystems."},{"Id":"7946077241","Type":"PullRequestEvent","CreatedAt":"2018-07-10T20:06:51","Actor":"marceldostal","Repository":"OfficeDev/Open-Xml-PowerTools","Organization":"OfficeDev","RawContent":null,"RelatedAction":"opened","RelatedUrl":"https://github.com/OfficeDev/Open-Xml-PowerTools/pull/233","RelatedDescription":"Opened pull request \"Added support for SVG graphics to the PresentationBuilder\" (#233) at OfficeDev/Open-Xml-PowerTools","RelatedBody":"While merging presentations SVG graphics where ignored at CopyRelatedPartsForContentParts and showed up as defect in the generated file."},{"Id":"7940943845","Type":"PullRequestEvent","CreatedAt":"2018-07-10T01:28:49","Actor":"willsolve","Repository":"OfficeDev/Open-Xml-PowerTools","Organization":"OfficeDev","RawContent":null,"RelatedAction":"opened","RelatedUrl":"https://github.com/OfficeDev/Open-Xml-PowerTools/pull/232","RelatedDescription":"Opened pull request \"WorksheetAccessor.cs CreatePivotTable null values\" (#232) at OfficeDev/Open-Xml-PowerTools","RelatedBody":"When CreatePivotTable is called on a range, it does not check for doubles past (startRow + 1) in a given column.  Curly braces were added in the row for-loop so that it won't break trying to convert an empty value to double."},{"Id":"7939105343","Type":"IssuesEvent","CreatedAt":"2018-07-09T17:42:27","Actor":"ObadMahrous","Repository":"OfficeDev/Open-Xml-PowerTools","Organization":"OfficeDev","RawContent":null,"RelatedAction":"opened","RelatedUrl":"https://github.com/OfficeDev/Open-Xml-PowerTools/issues/231","RelatedDescription":"Opened issue \"Viewing the result of comparing documents in html\" (#231) at OfficeDev/Open-Xml-PowerTools","RelatedBody":"I need to display the result of comparison of documents in html such as displayed in word \r\nThe result is displayed but without highlighting the changes in html\r\n\r\nThanks"}],"ResultType":"GitHubEvent"}},"RunOn":"2018-07-19T05:30:46.1065162Z","RunDurationInMilliseconds":1621}